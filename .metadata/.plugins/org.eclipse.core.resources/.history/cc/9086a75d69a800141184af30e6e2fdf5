import java.io.BufferedWriter;
import java.io.File;
import java.io.FileWriter;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Scanner;

public class TextBuddy {

	public static void main(String[] args) {

		String fileName = args[0];

		System.out.println("Welcome to TextBuddy. mytextfile.txt is ready for use");

		Scanner sc = new Scanner(System.in);
		String command = null;

		ArrayList<String> list = new ArrayList<String>();
		list.add(null);

		do {
			System.out.print("command: ");
			command = sc.next();
			String text = sc.nextLine();
			if (command.equals("add")) {
				add(fileName, text, list);
			}
			else if (command.equals("display")) {
				display(fileName);
			}
			else if (command.equals("delete")) {
				int num = Integer.parseInt(text);
				delete(fileName, num, list);
			}
			else if (command.equals("clear")) {
				clear(fileName, list);
			}
		} while (!command.equals("exit"));

	}

	public static int getIndex(String text, ArrayList<String> list) {
		for (int i=1; i<list.size(); i++) {
			String line = list.get(i);
			if (text.equals(line)) {
				return i;
			}
		}
		return -1;
	}

	public static void updateFile(String fileName, ArrayList<String> list) throws IOException {

		Scanner sc = null;
		FileWriter fw = null;
		BufferedWriter out = null;

		try {
			sc = new Scanner(new File(fileName));
			fw = new FileWriter(fileName, true);
			out = new BufferedWriter(fw);	
			for (int i = 1; i<list.size(); i++) {
				String line = list.get(i);
				out.write(i + ". " + line);
				out.write("\n");
			}
		} catch (IOException e) {
			e.printStackTrace();
		} finally {
			if (sc != null) {
				sc.close();
			}
			if (fw != null) {
				fw.close();
			}
			if (out != null) {
				out.close();
			}
		}
	}

	public static void add(String fileName, String text, ArrayList<String> list) throws IOException {
		Scanner sc = null;
		FileWriter fw = null;
		BufferedWriter out = null;
		int currentIndex = 0;

		try {
			sc = new Scanner(new File(fileName));
			fw = new FileWriter(fileName, true);
			out = new BufferedWriter(fw);
			if (!(sc.hasNextLine())) {
				list.add(text);
				currentIndex = getIndex(text, list);
				out.write(currentIndex + ". " + text);
				out.write("\n");
			}
			else if (sc.hasNextLine()) {
				list.add(text);
				updateFile(fileName, list);
			}
		} catch (IOException e) {
			e.printStackTrace();
		} finally {
			if (sc != null) {
				sc.close();
			}
			if (fw != null) {
				fw.close();
			}
			if (out != null) {
				out.close();
			}
		}
		System.out.println("added to " + fileName + ": " + text);
	}

	public static void display(String fileName) {
		Scanner sc = null;

		try {
			sc = new Scanner(new File(fileName));
			if (sc.hasNextLine()) {
				do {
				System.out.println(sc.nextLine());
				} while (sc.hasNextLine());
			} else {
				System.out.println(fileName + " is empty");
			} 
		} catch (IOException e) {
			e.printStackTrace();
		} finally {
			if (sc != null) {
				sc.close();
			}
		}
	}

	public static void delete(String fileName, int num, ArrayList<String> list) throws IOException {
		
		if (!list.isEmpty()) {
			String deletedLine = list.get(num);
			list.remove(num);
			updateFile(fileName, list);
			System.out.println("deleted from " + fileName + ": " + deletedLine);
		}	
	}

	public static void clear(String fileName, ArrayList<String> list) throws IOException {
		if (!list.isEmpty()) {
			list.clear();
			updateFile(fileName, list);
		}

		System.out.println("all content deleted from " + fileName);
	}

}
